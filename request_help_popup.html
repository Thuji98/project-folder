<!DOCTYPE html>
<html>
    <head>
        <title> Help request</title>
        <link rel="stylesheet" href="css_codes/help_request_popup.css">
    </head>

    <body>
        <div class="div1 popup" id='help_request_popup'>
            <div  class="form_box">
                <div class=dis_container>
                    <label class="head_label"> District (current) </label><br>
                    <select name="district" class="dis_selection">
                        <option value='Ampara'>Ampara</option>
                        <option value='Anurashapura'>Anurashapura</option>
                        <option value='Badulla'>Badulla</option>
                        <option value='Batticaloa'>Batticaloa</option>
                        <option value='Colombo'>Colombo</option>
                        <option value='Galle'>Galle</option>
                        <option value='Gampha'>Gampha</option>
                        <option value='Hambatota'>Hambantota</option>
                        <option value='Jaffna'>Jaffna</option>
                        <option value='Kaltura'>Kaltura</option>
                        <option value='Kandy'>Kandy</option>
                        <option value='Kegalle'>Kegalle</option>
                        <option value='Kilinochchi'>Kilinochchi</option>
                        <option value='Kurunegala'>Kurunegala</option>
                        <option value='Mannar'>Mannar</option>
                        <option value='Matale'>Matale</option>
                        <option value='Mathara'>Mathara</option>
                        <option value='Moneragala'>Moneragala</option>
                        <option value='Mullaitivu'></option>
                        <option value='Nuwara-Eliya'>Nuwara-Eliya</option>
                        <option value='Polonnaruwa'>Polonnaruwa</option>
                        <option value='Puttalam'>Puttalam</option>
                        <option value='Ratnapura'>Ratnapura</option>
                        <option value='Tricomalee'>Tricomalee</option>
                        <option value='Vavuniya'>Vavuniya</option>
                    </select>
                </div>


                <div class=head_label_container><label class="head_label">Help Type </label></div>
                <table>
                    <tr>
                        <td class=check_menu>
                            <input type="checkbox" name="type[]" value="money" onclick="OnChangeCheckbox (this,'money_des_con')" id ="money"> Money<br>
                        </td>
                        <td class=des_area>
                            <div id=money_des_con style="display:none">
                                <label class="label">Enter amount you expect</label><br>
                                <textarea cols="30" rows="4"  class="input_box" name="money_description" id="money_des"></textarea><br>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class=check_menu>
                            <input type="checkbox" name="type[]" value="good" onclick="OnChangeCheckbox (this,'goods_des_con')" id ="good">Things<br>
                        </td>
                        <td class=des_area>
                            <div id=goods_des_con style="display:none">
                                <label class="label">Things you expect</label><br>
                                <textarea cols="30" rows="4"  class="input_box" name="good_description" id="good_des"></textarea><br>
                            </div>
                        </td>
                    </tr>
                </table>
                <div class=buttons>
                    <input name="submit_button" type="submit"  value="Request"  class="submit_button" id=req_submit_btn>
                    <button id=close_request_popup class=submit_button>Cancel</button>
                </div>
            </div>
        </div>
        <div id='overlay'>

        </div>

        <script>
            var allOptions = document.getElementsByTagName('option');
            var results = [];
            for(var x=0; x<allOptions.length; x++){
                if(allOptions[x].value == district_in_nic){
                    allOptions[x].defaultSelected = true;
                }
            }
            function OnChangeCheckbox (checkbox,textbox) {
                if (checkbox.checked) {
                    document.getElementById(textbox).style.display="block"; 
                }
                else {
                    document.getElementById(textbox).style.display="none"; 
                }
            }

            const submit_button = document.getElementById('req_submit_btn');
            submit_button.addEventListener('click',()=>{

                var district = document.getElementsByTagName('select')[0].value;
                var help_type = [];
                if(document.getElementById('money').checked){
                    help_type.push(document.getElementById('money').value);
                }
                if(document.getElementById('good').checked){
                    help_type.push(document.getElementById('good').value);
                }

                var money_description = document.getElementById('money_des').value;
                var good_description = document.getElementById('good_des').value;

                const request = new XMLHttpRequest();

                request.onload = () => {
                    console.log(request.responseText);
                    /*let responseObject = null;
                    try{
                        responseObject = JSON.parse(request.responseText);
                    }catch(e){
                        console.error('Could not parse JSON');
                    }
                    if(responseObject){
                        console.log(responseObject);
                    }*/
                };
                const requestData = `event_id=`+ event_id + `&district=`+district + `&type=` + help_type + `&money_description=` + money_description + `&good_description` + good_description + `&submit_button=` + 'submit';

                request.open('post', 'request_help.php');
                request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                request.send(requestData);

                help_status = 'requested';

                var html2 =     "<button id='help_request_option' disabled>Help Requested</button>" +
                                "<div id=changeRequest>"+
                                    "<button class=drop_dwn name=method value=cancel onclick=cancel_request()>Cancel Request</button><br>"+
                                    "<button class=drop_dwn name=method value=option onclick=request_option()>Request Option</button>"+
                                "</div>";
                help_btn.innerHTML = html2;

                document.getElementById('help_request_popup').classList.remove('active');
                overlay.classList.remove('active');
            })
            
        </script>    
    </body>
</html>